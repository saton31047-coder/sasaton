<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Webルーレット</title>

<style>
body{
  margin:0;
  text-align:center;
  font-family:"Hiragino Sans","Noto Sans JP","Meiryo",sans-serif;
  background:#f8f8f8;
}

/* ===== メイン ===== */
h2{
  margin:10px 0;
  font-size:clamp(18px,5vw,26px);
  cursor:pointer;
}
.pointer{
  width:0;height:0;
  border-left:14px solid transparent;
  border-right:14px solid transparent;
  border-bottom:24px solid red;
  margin:6px auto;
}
canvas{
  max-width:90vw;
  height:auto;
}
button{
  font-size:clamp(14px,4vw,18px);
  padding:8px 16px;
  margin:8px;
  border-radius:8px;
  background:rgba(0,0,0,0.05);
  border:1px solid #ccc;
  cursor:pointer;
}
#resultBox{
  margin-top:10px;
  font-size:clamp(18px,5vw,24px);
  font-weight:bold;
}

/* ===== 管理者コード入力 ===== */
#adminPassBox{
  display:none;
  position:fixed;
  bottom:12px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.02);
  padding:6px 10px;
  border-radius:10px;
  gap:6px;
  align-items:center;
}
#adminPassBox label,
#adminPassBox input,
#adminPassBox button{
  font-size:clamp(12px,3vw,14px);
  color:rgba(0,0,0,0.25);
}
#adminPassBox input{
  width:140px;
  padding:4px;
  border-radius:8px;
  border:1px solid rgba(0,0,0,0.1);
  background:rgba(255,255,255,0.25);
}

/* ===== 管理者パネル ===== */
#adminPanel{
  display:none;
  position:fixed;
  inset:0;
  background:#000;
  color:#00ff00;
  z-index:1000;
  overflow-y:auto;      /* ← はみ出し防止 */
  padding:16px;
}

#adminPanelInner{
  max-width:600px;
  margin:auto;
  display:flex;
  flex-direction:column;
  align-items:center;
}

#adminPanel h3{
  font-size:clamp(22px,6vw,36px);
  margin:20px 0;
}

.adminBtn{
  font-size:clamp(16px,5vw,22px);
  padding:10px 20px;
  margin:8px;
  background:#000;
  color:#00ff00;
  border:2px solid #00ff00;
  border-radius:12px;
  width:100%;
  max-width:320px;
}

/* ===== QR ===== */
#qrBox{
  display:none;
  margin-top:16px;
}
#qrBox img{
  width:200px;
  max-width:80vw;
}
</style>
</head>

<body>

<h2 id="title">Webルーレット</h2>
<div class="pointer"></div>
<canvas id="roulette"></canvas><br>
<button id="spinBtn">開始</button>
<div id="resultBox"></div>

<!-- 管理者パネル -->
<div id="adminPanel">
  <div id="adminPanelInner">
    <h3>管理者パネル</h3>

    <button class="adminBtn" onclick="setForce('1等')">1等</button>
    <button class="adminBtn" onclick="setForce('2等')">2等</button>
    <button class="adminBtn" onclick="setForce('3等')">3等</button>
    <button class="adminBtn" onclick="setForce('4等')">4等</button>
    <button class="adminBtn" onclick="setForce('5等')">5等</button>
    <button class="adminBtn" onclick="setForce('ハズレ')">ハズレ</button>
    <button class="adminBtn" onclick="clearForce()">選択削除</button>

    <div id="qrBox">
      <img id="qrImg">
    </div>

    <button class="adminBtn" onclick="closeAdmin()">閉じる</button>
  </div>
</div>

<!-- 管理者コード -->
<div id="adminPassBox">
  <label>管理者コード</label>
  <input type="password" id="adminPass" placeholder="管理者コード">
  <button onclick="checkPass()">OK</button>
</div>

<script>
/* ===== ルーレット ===== */
const canvas=document.getElementById("roulette");
const ctx=canvas.getContext("2d");

const items=["1等","2等","3等","4等","5等","ハズレ","4等","3等","2等","5等"];
const colorMap={
  "1等":"#ff9999","2等":"#99ccff","3等":"#cc99ff",
  "4等":"#99ff99","5等":"#ffe699","ハズレ":"#cccccc"
};
const colors=items.map(v=>colorMap[v]);
const angle=Math.PI*2/items.length;

let rotation=0,spinning=false,forced=null;

function resize(){
  const s=Math.min(innerWidth*0.8,innerHeight*0.55,420);
  canvas.width=canvas.height=s;
  draw();
}
addEventListener("resize",resize);

function draw(){
  const c=canvas.width/2;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.font=`${c*0.14}px sans-serif`;
  items.forEach((v,i)=>{
    ctx.beginPath();
    ctx.moveTo(c,c);
    ctx.arc(c,c,c,i*angle+rotation,(i+1)*angle+rotation);
    ctx.fillStyle=colors[i];
    ctx.fill();
    ctx.save();
    ctx.translate(c,c);
    ctx.rotate(i*angle+angle/2+rotation);
    ctx.textAlign="right";
    ctx.fillStyle="#000";
    ctx.fillText(v,c-20,8);
    ctx.restore();
  });
}

spinBtn.onclick=()=>{
  if(spinning)return;
  spinning=true;
  const idx=forced?items.findIndex(v=>v===forced):Math.floor(Math.random()*items.length);
  const target=Math.PI*8 - idx*angle - angle/2 - Math.PI/2;
  const start=rotation;
  let t0=null;
  function anim(t){
    if(!t0)t0=t;
    const p=Math.min((t-t0)/3000,1);
    rotation=start+(target-start)*(p*p*(3-2*p));
    draw();
    if(p<1)requestAnimationFrame(anim);
    else{
      resultBox.textContent="結果："+items[idx];
      spinning=false;
    }
  }
  requestAnimationFrame(anim);
};
resize();

/* ===== 管理者 ===== */
let tap=0, timer=null;
title.onclick=()=>{
  tap++;
  if(tap>=5){
    adminPassBox.style.display="flex";
    clearTimeout(timer);
    timer=setTimeout(()=>adminPassBox.style.display="none",10000);
    tap=0;
  }
};

function checkPass(){
  if(adminPass.value==="admin"){
    adminPanel.style.display="block";
    adminPassBox.style.display="none";
  }
}
function setForce(v){
  forced=v;
  qrImg.src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data="+encodeURIComponent(v);
  qrBox.style.display="block";
}
function clearForce(){forced=null;qrBox.style.display="none";}
function closeAdmin(){adminPanel.style.display="none";qrBox.style.display="none";}
</script>

</body>
</html>
